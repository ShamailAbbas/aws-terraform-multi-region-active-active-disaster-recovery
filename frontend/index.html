<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Media Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background-color: #f4f7fa;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background: #0d6efd;
      color: white;
      padding: 16px 30px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    main {
      max-width: 900px;
      margin: 30px auto;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    input[type="file"] {
      flex: 1;
      padding: 8px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    button {
      background: #0d6efd;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #0b5ed7;
    }

    .status {
      margin-bottom: 20px;
      color: #555;
      font-size: 0.95rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
    }

    .media-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      overflow: hidden;
      background: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    .media-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
    }

    .media-card img,
    .media-card video {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
      background: #eee;
    }

    .media-info {
      padding: 10px 12px;
      font-size: 0.9rem;
      text-align: center;
      color: #444;
    }

    .delete-btn {
      background: #dc3545;
      border: none;
      color: white;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 0.85rem;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
    }

    .delete-btn:hover {
      background: #bb2d3b;
    }

    footer {
      text-align: center;
      padding: 15px;
      color: #777;
      font-size: 0.85rem;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <main>
    <form id="uploadForm">
      <input type="file" id="fileInput" accept="image/*,video/*" required />
      <button type="submit">Upload</button>
    </form>
    <div class="status" id="status">Loading media...</div>
    <div class="grid" id="mediaGrid"></div>
  </main>

  <footer>
    Content Service &copy; 2025
  </footer>

  <script>
    // const API_BASE = 'http://multi-region-app-primary-alb-1228095517.us-east-1.elb.amazonaws.com';
    const API_BASE = 'http://multi-region-app-secondary-alb-408077139.us-east-2.elb.amazonaws.com';

    const mediaGrid = document.getElementById('mediaGrid');
    const status = document.getElementById('status');
    const uploadForm = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');

    // -------------------
    // Fetch and Render Media
    // -------------------
    async function fetchMedia() {
      try {
        status.textContent = 'Loading media...';
        const res = await fetch(`${API_BASE}/api/media`);
        const data = await res.json();

        if (!data.media || data.media.length === 0) {
          status.textContent = 'No media found.';
          mediaGrid.innerHTML = '';
          return;
        }

        status.textContent = `Showing ${data.count} media files`;

        mediaGrid.innerHTML = data.media.map(item => `
          <div class="media-card">
            ${
              item.url.match(/\.(mp4|webm|ogg)$/i)
                ? `<video controls src="${item.url}"></video>`
                : `<img src="${item.url}" alt="${item.filename}" />`
            }
            <div class="media-info">
              ${item.filename}<br/>
              <button class="delete-btn" onclick="deleteMedia('${item.id}', '${item.filename}')">üóëÔ∏è Delete</button>
            </div>
          </div>
        `).join('');

      } catch (err) {
        console.error('Error fetching media:', err);
        status.textContent = 'Failed to load media.';
      }
    }

    // -------------------
    // Upload Media
    // -------------------
    uploadForm.addEventListener('submit', async e => {
      e.preventDefault();
      const file = fileInput.files[0];
      if (!file) return alert('Please select a file');

      status.textContent = 'Uploading...';
      const formData = new FormData();
      formData.append('file', file);

      try {
        const res = await fetch(`${API_BASE}/api/media`, {
          method: 'POST',
          body: formData
        });
        const data = await res.json();
        if (res.ok) {
          status.textContent = `‚úÖ Uploaded: ${data.media.filename}`;
          fileInput.value = '';
          fetchMedia();
        } else {
          status.textContent = '‚ùå Upload failed: ' + (data.error || 'Unknown error');
        }
      } catch (err) {
        console.error('Upload error:', err);
        status.textContent = '‚ùå Upload failed.';
      }
    });

    // -------------------
    // Delete Media
    // -------------------
    async function deleteMedia(id, filename) {
      if (!confirm(`Are you sure you want to delete "${filename}"?`)) return;

      status.textContent = `Deleting "${filename}"...`;

      try {
        const res = await fetch(`${API_BASE}/api/media/${id}`, { method: 'DELETE' });
        const data = await res.json();

        if (res.ok) {
          status.textContent = `üóëÔ∏è Deleted: ${filename}`;
          fetchMedia();
        } else {
          status.textContent = '‚ùå Delete failed: ' + (data.error || 'Unknown error');
        }
      } catch (err) {
        console.error('Delete error:', err);
        status.textContent = '‚ùå Delete failed.';
      }
    }

    // Initial Load
    fetchMedia();
  </script>
</body>
</html>
